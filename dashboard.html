<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة الطالب - إعدادية رافدين</title>
<style>
  body {
    font-family: Tahoma, sans-serif;
    margin: 0;
    background: url('https://k.top4top.io/p_3498f7ivx1.png') no-repeat center center fixed;
    background-size: cover;
    transition: background 0.3s;
  }
  header {
    background: linear-gradient(90deg,#54B8C2,#F4BE45);
    color:white;
    padding:12px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  header img.logo {
    width: 60px;
  }
  #menu-btn {
    font-size: 28px;
    cursor: pointer;
    background: none;
    border: none;
    color: white;
  }
  .app-wrap {
    display:flex;
    gap:20px;
    max-width:1100px;
    margin:20px auto;
    padding:10px;
  }
  .sidebar {
    width:0;
    overflow:hidden;
    transition: width 0.3s;
    background: rgba(255,255,255,0.95);
    border-radius:8px;
    padding:12px;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
    position:fixed;
    top:0;
    bottom:0;
    right:0;
    z-index:1000;
  }
  .sidebar.open {
    width:25%;
    min-width:200px;
  }
  .sidebar img.logo-small {
    display:block;
    margin:0 auto 10px auto;
    width:60px;
  }
  .sidebar button {
    width:100%;
    padding:10px 12px;
    margin:6px 0;
    text-align:right;
    font-size:15px;
    cursor:pointer;
    border-radius:6px;
    border:1px solid rgba(0,0,0,0.06);
    background:#fff;
    transition: all 0.2s;
  }
  .sidebar button.active {
    background: linear-gradient(90deg,#F4BE45,#54B8C2);
    color:#fff;
    border:none;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
  }
  main.main {
    flex:1;
    background: rgba(255,255,255,0.95);
    border-radius:8px;
    padding:18px;
    box-shadow:0 2px 8px rgba(0,0,0,0.06);
    transition: margin 0.3s;
  }
  .student-card {
    display:flex;
    gap:14px;
    align-items:center;
    margin-bottom:14px;
  }
  .student-card div.avatar {
    width:82px; height:82px;
    border-radius:10px;
    background:#f1f1f1;
    display:flex;align-items:center;justify-content:center;
    font-size:28px;
    color:#777;
  }
  .student-info h2 { margin:0 0 6px 0; font-size:20px; }
  .student-meta { color:#555; font-size:14px; }
  .admin-message {
    margin:12px 0;
    padding:12px;
    background:#fff6e6;
    border-left:4px solid #F4BE45;
    border-radius:6px;
    display:none;
  }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ddd; padding:8px; text-align:center; font-size:14px; }
  th { background:#F4BE45; color:white; }
  td.fail { color:red; font-weight:bold; }
  .news-list, .activities-list { margin-top:10px; display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:10px; }
  .news-card, .activity-card { padding:12px; border-radius:8px; background:#fafafa; border:1px solid #eee; }
  .news-card h4, .activity-card h4 { margin:0 0 6px 0; font-size:15px; }
  .news-card time, .activity-card time { font-size:13px; color:#777; }
  /* Dark mode */
  body.dark .main, body.dark .sidebar { background: rgba(32,32,32,0.86); color:#e9eef1; }
  body.dark .news-card, body.dark .activity-card { background: rgba(0,0,0,0.45); border-color: rgba(255,255,255,0.06); }
  body.dark .admin-message { background: rgba(255,255,255,0.03); color:#fff; border-left-color:#F4BE45; }
  /* Responsive */
  @media(max-width:900px){ .app-wrap{ flex-direction:column; padding:12px; margin:12px; } }
</style>
</head>
<body>
<header>
  <img src="https://e.top4top.io/p_34909jjnx0.png" class="logo">
  <button id="menu-btn">☰</button>
</header>

<div class="app-wrap">
  <aside class="sidebar" id="sidebar">
    <img src="https://e.top4top.io/p_34909jjnx0.png" class="logo-small">
    <button id="btn-home" class="active">الرئيسية</button>
    <button id="btn-grades">درجاتي</button>
    <button id="btn-timetable">جدول الأسبوعي</button>
    <button id="btn-activities">النشاطات</button>
    <button id="btn-dark">الوضع المظلم</button>
    <button id="btn-contact">تواصل معنا</button>
  </aside>

  <main class="main" id="main-content">
    <section id="home-section">
      <div class="student-card">
        <div class="avatar">👩‍🎓</div>
        <div class="student-info">
          <h2 id="student-name">اسم الطالب</h2>
          <div class="student-meta"><span id="student-class">الصف</span> — شعبة <span id="student-section">شعبة</span></div>
        </div>
      </div>
      <div id="admin-msg" class="admin-message"></div>
      <div class="section">
        <h3>الأخبار</h3>
        <div id="news-container" class="news-list"></div>
      </div>
    </section>

    <section id="grades-section" class="hidden">
      <h3>درجاتي</h3>
      <div id="grades-container"></div>
    </section>

    <section id="timetable-section" class="hidden">
      <h3>جدول الأسبوعي</h3>
      <div id="timetable-container"></div>
    </section>

    <section id="activities-section" class="hidden">
      <h3>النشاطات</h3>
      <div id="activities-container" class="activities-list"></div>
    </section>

    <section id="contact-section" class="hidden">
      <h3>تواصل معنا</h3>
      <p class="light-muted">روابط التواصل قابلة للتعديل من قبل الإدارة.</p>
      <div><a href="#" id="fb-link" target="_blank">فيسبوك</a> — <a href="#" id="tg-link" target="_blank">تيليجرام</a></div>
    </section>
  </main>
</div>

<script>
// Helper
function q(sel){ return document.querySelector(sel); }
function showSection(id){
  document.querySelectorAll('main.main section').forEach(s=>s.classList.add('hidden'));
  q('#'+id).classList.remove('hidden');
  document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));
  const map={'home-section':'btn-home','grades-section':'btn-grades','timetable-section':'btn-timetable','activities-section':'btn-activities','contact-section':'btn-contact'};
  const btn=q('#'+map[id]); if(btn) btn.classList.add('active');
  // close sidebar after selection
  q('#sidebar').classList.remove('open');
}
const sidebar=q('#sidebar');
q('#menu-btn').addEventListener('click',()=> sidebar.classList.toggle('open'));
q('#btn-home').addEventListener('click',()=> showSection('home-section'));
q('#btn-grades').addEventListener('click',()=> showSection('grades-section'));
q('#btn-timetable').addEventListener('click',()=> showSection('timetable-section'));
q('#btn-activities').addEventListener('click',()=> showSection('activities-section'));
q('#btn-contact').addEventListener('click',()=> showSection('contact-section'));

// Load student data
const student=JSON.parse(localStorage.getItem('studentData')||'null');
if(!student){ alert('لم يتم العثور على بيانات الطالب. الرجاء تسجيل الدخول.'); window.location.href='index.html'; }
else{
  q('#student-name').textContent=student['الاسم']||'—';
  q('#student-class').textContent=student['الصف']||'—';
  q('#student-section').textContent=student['الشعبة']||'—';
  const adminMsg=student['رسالة_الإدارة']||student['adminMessage']||'';
  if(adminMsg){ const el=q('#admin-msg'); el.style.display='block'; el.innerHTML=adminMsg.replace(/\n/g,'<br>'); }

  // Grades
  const grades=student['الدرجات']||{};
  let html='<table><thead><tr><th>المادة</th><th>الشهر 1</th><th>الشهر 2</th><th>الشهر 3</th><th>السعي</th><th>نصف السنة</th></tr></thead><tbody>';
  for(const subj in grades){
    const row=grades[subj];
    html+='<tr>';
    html+=`<td>${subj}</td>`;
    html+=`<td class="${row['شهر1']<50?'fail':''}">${row['شهر1']||'—'}</td>`;
    html+=`<td class="${row['شهر2']<50?'fail':''}">${row['شهر2']||'—'}</td>`;
    html+=`<td class="${row['شهر3']<50?'fail':''}">${row['شهر3']||'—'}</td>`;
    html+=`<td class="${row['السعي']<50?'fail':''}">${row['السعي']||'—'}</td>`;
    html+=`<td class="${row['نصف_السنة']<50?'fail':''}">${row['نصف_السنة']||'—'}</td>`;
    html+='</tr>';
  }
  html+='</tbody></table>';
  q('#grades-container').innerHTML=html;

  // Timetable
  const tt=student['الجدول']||{};
  let ttHtml='<table><thead><tr><th>اليوم</th><th>الحصة 1</th><th>الحصة 2</th><th>الحصة 3</th><th>الحصة 4</th><th>الحصة 5</th><th>الحصة 6</th></tr></thead><tbody>';
  for(const day in tt){
    ttHtml+='<tr><td>'+day+'</td>';
    for(let i=0;i<6;i++) ttHtml+='<td>'+(tt[day][i]||'—')+'</td>';
    ttHtml+='</tr>';
  }
  ttHtml+='</tbody></table>';
  q('#timetable-container').innerHTML=ttHtml;
}

// Load news
fetch('/student/news.json').then(r=>r.json()).then(list=>{
  const news=q('#news-container'); news.innerHTML='';
  list.slice(0,3).forEach(n=>{
    const card=document.createElement('div'); card.className='news-card';
    card.innerHTML=`<h4>${n.title||'خبر'}</h4><time>${n.date||''}</time><div>${n.description||''}</div>`;
    news.appendChild(card);
  });
}).catch(e=>console.warn(e));

// Load activities
fetch('/student/ac.json').then(r=>r.json()).then(list=>{
  const act=q('#activities-container'); act.innerHTML='';
  list.forEach(n=>{
    const card=document.createElement('div'); card.className='activity-card';
    card.innerHTML=`<h4>${n.title||'نشاط'}</h4><time>${n.date||''}</time><div>${n.description||''}</div>`;
    act.appendChild(card);
  });
}).catch(e=>console.warn(e));

// Dark mode
const darkBtn=q('#btn-dark');
darkBtn.addEventListener('click',()=>{
  document.body.classList.toggle('dark');
  darkBtn.classList.toggle('active');
  localStorage.setItem('darkMode',document.body.classList.contains('dark')?'1':'0');
});
if(localStorage.getItem('darkMode')==='1'){ document.body.classList.add('dark'); darkBtn.classList.add('active'); }
</script>
</body>
</html>
