<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>لوحة الطالب - إعدادية رافدين</title>
<link rel="stylesheet" href="style.css">
<style>
body { font-family:'Tahoma',sans-serif; background:url('https://k.top4top.io/p_3498f7ivx1.png') no-repeat center center fixed; background-size:cover; margin:0; padding:0; transition:0.3s; }
header { background:linear-gradient(90deg,#54B8C2,#F4BE45); color:white; padding:12px 20px; display:flex; justify-content:space-between; align-items:center; }
header .logo { width:80px; }
header #hamburger { font-size:26px; cursor:pointer; background:none; border:none; color:white; }
.sidebar { position:fixed; top:0; right:-250px; width:250px; height:100%; background:rgba(255,255,255,0.98); box-shadow:-2px 0 6px rgba(0,0,0,0.1); padding:20px; transition:0.3s; z-index:1000; }
.sidebar.active { right:0; }
.sidebar button { width:100%; padding:10px; margin:8px 0; border:none; border-radius:6px; cursor:pointer; background:#f4b400; color:white; font-size:16px; }
.sidebar button.active-btn { background: linear-gradient(90deg,#F4BE45,#54B8C2); }
.main { margin:80px auto 20px auto; max-width:1100px; padding:20px; background:rgba(255,255,255,0.95); border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.student-info h2 { margin:0; font-size:20px; }
.student-info .meta { font-size:14px; color:#555; margin-top:4px; }
.admin-message { margin:12px 0; padding:12px; background:#fff6e6; border-left:4px solid #F4BE45; border-radius:6px; display:none; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #ccc; padding:10px; text-align:center; }
th { background:#f4b400; color:white; }
td.fail { color:red; font-weight:bold; }
section.hidden { display:none; }
body.dark .main, body.dark .sidebar { background:rgba(32,32,32,0.86); color:#e9eef1; }
body.dark th, body.dark td { border-color:#555; }
body.dark .admin-message { background:rgba(255,255,255,0.03); border-left-color:#F4BE45; color:white; }
@media(max-width:900px){.sidebar{width:70%;}}
</style>
</head>
<body>
<header>
  <img src="https://e.top4top.io/p_34909jjnx0.png" class="logo">
  <button id="hamburger">&#9776;</button>
</header>

<div class="sidebar" id="sidebar">
  <button id="btn-home" class="active-btn">الرئيسية</button>
  <button id="btn-grades">درجاتي</button>
  <button id="btn-timetable">جدولي</button>
  <button id="btn-activities">النشاطات</button>
  <button id="btn-news">الأخبار</button>
  <button id="btn-dark">الوضع المظلم</button>
  <button id="logoutBtn">تسجيل الخروج</button>
</div>

<div class="main">
  <section id="home-section">
    <div class="student-info">
      <h2 id="student-name">اسم الطالب</h2>
      <div class="meta"><span id="student-class">الصف</span> - شعبة <span id="student-section">الشعبة</span></div>
    </div>
    <div class="admin-message" id="admin-msg"></div>
  </section>

  <section id="grades-section" class="hidden"></section>
  <section id="timetable-section" class="hidden"></section>
  <section id="activities-section" class="hidden"></section>
  <section id="news-section" class="hidden"></section>
</div>

<script>
// sidebar toggle
const sidebar = document.getElementById('sidebar');
const hamburger = document.getElementById('hamburger');
hamburger.onclick = ()=> sidebar.classList.toggle('active');

// sections
function showSection(id){
  document.querySelectorAll('.main section').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active-btn'));
  const map = {home-section:'btn-home', grades-section:'btn-grades', timetable-section:'btn-timetable', activities-section:'btn-activities', news-section:'btn-news'};
  const btn = document.getElementById(map[id]); if(btn) btn.classList.add('active-btn');
  sidebar.classList.remove('active'); // close after click
}
document.getElementById('btn-home').onclick=()=>showSection('home-section');
document.getElementById('btn-grades').onclick=()=>showSection('grades-section');
document.getElementById('btn-timetable').onclick=()=>showSection('timetable-section');
document.getElementById('btn-activities').onclick=()=>showSection('activities-section');
document.getElementById('btn-news').onclick=()=>showSection('news-section');

// dark mode
const darkBtn = document.getElementById('btn-dark');
darkBtn.onclick=()=>{
  document.body.classList.toggle('dark');
  darkBtn.classList.toggle('active-btn');
  localStorage.setItem('darkMode', document.body.classList.contains('dark')?'1':'0');
};
if(localStorage.getItem('darkMode')==='1'){document.body.classList.add('dark'); darkBtn.classList.add('active-btn');}

// logout
document.getElementById('logoutBtn').onclick=()=>{
  localStorage.removeItem('studentData');
  window.location.href='index.html';
};

// load student
const student = JSON.parse(localStorage.getItem('studentData')||'null');
if(!student){ alert('لم يتم العثور على بيانات الطالب'); window.location.href='index.html'; }
else {
  document.getElementById('student-name').textContent = student['الاسم'];
  document.getElementById('student-class').textContent = student['الصف'];
  document.getElementById('student-section').textContent = student['الشعبة'];
  const msg = student['رسالة'] || student['رسالة_الإدارة'] || '';
  if(msg){ const m = document.getElementById('admin-msg'); m.style.display='block'; m.innerHTML=msg; }
  // grades
  const gradesSec = document.getElementById('grades-section');
  const grades = student['الدرجات'] || {};
  let html='<h3>درجاتي</h3><table><thead><tr><th>المادة</th><th>شهر1</th><th>شهر2</th><th>شهر3</th><th>نصف السنة</th><th>النهائي</th><th>بعد الإكمال</th></tr></thead><tbody>';
  for(const [sub,d] of Object.entries(grades)){
    const fail = v=>parseFloat(v)<50? ' class="fail"':'';
    html+=`<tr><td>${sub}</td><td${fail(d['الشهر الأول']||0)}>${d['الشهر الأول']||0}</td><td${fail(d['الشهر الثاني']||0)}>${d['الشهر الثاني']||0}</td><td${fail(d['الشهر الثالث']||0)}>${d['الشهر الثالث']||0}</td><td${fail(d['نصف السنة']||0)}>${d['نصف السنة']||0}</td><td${fail(d['النهائي']||0)}>${d['النهائي']||0}</td><td${fail(d['بعد الإكمال']||0)}>${d['بعد الإكمال']||0}</td></tr>`;
  }
  html+='</tbody></table>';
  gradesSec.innerHTML=html;

  // timetable
  const ttSec = document.getElementById('timetable-section');
  const tt = student['الجدول']||{};
  let tthtml='<h3>جدولي الأسبوعي</h3><table><thead><tr><th>اليوم</th><th>حصة1</th><th>حصة2</th><th>حصة3</th><th>حصة4</th><th>حصة5</th><th>حصة6</th></tr></thead><tbody>';
  for(const [day,row] of Object.entries(tt)){
    tthtml+='<tr><td>'+day+'</td>'+row.map(c=>' <td>'+c+'</td>').join('')+'</tr>';
  }
  tthtml+='</tbody></table>';
  ttSec.innerHTML=tthtml;

  // activities
  const actSec = document.getElementById('activities-section');
  fetch('/student/ac.json').then(r=>r.json()).then(list=>{
    let actHtml='<h3>النشاطات</h3><table><thead><tr><th>النشاط</th><th>اليوم</th><th>الوقت</th></tr></thead><tbody>';
    list.forEach(a=>{ actHtml+='<tr><td>'+a.title+'</td><td>'+a.day+'</td><td>'+a.time+'</td></tr>'; });
    actHtml+='</tbody></table>'; actSec.innerHTML=actHtml;
  });

  // news
  const newsSec = document.getElementById('news-section');
  fetch('/student/news.json').then(r=>r.json()).then(list=>{
    let newsHtml='<h3>الأخبار</h3><table><thead><tr><th>العنوان</th><th>التاريخ</th><th>الوصف</th></tr></thead><tbody>';
    list.slice(0,5).forEach(n=>{ newsHtml+='<tr><td>'+n.title+'</td><td>'+n.date+'</td><td>'+n.description+'</td></tr>'; });
    newsHtml+='</tbody></table>'; newsSec.innerHTML=newsHtml;
  });
}
</script>
</body>
</html>
